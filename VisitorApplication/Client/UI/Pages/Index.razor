@page "/{informationboardID:int}"
@using VisitorApplication.Shared
@inject HttpClient Http

<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn-uicons.flaticon.com/uicons-regular-rounded/css/uicons-regular-rounded.css">
</head>


@if (informationboardList == null)
{
    <h1 class="display-5 m-1" style="color: white;">Loading...</h1>
}
else
{
    foreach (var informationboard in informationboardList)
    {


        // Displays the published information board, if any at the specific path
        if (informationboardID == informationboard.InformationboardID && informationboard.IsPublished == true)
        {
            <head>
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.0/font/bootstrap-icons.css">
            </head>

            <section class="col-12">
                @if (@informationboard.Title.Length > 15)
                {
                    <p class="text-white display-5 text-center fw-bold mt-2">
                        @informationboard.Title
                    </p>
                }
                else
                {
                    <p class="text-white display-2 text-center fw-bold mt-2 mb-1">
                        @informationboard.Title
                    </p>
                }
                <!-- Linje under overskrift -->
                <div class="col-5 mx-auto mt-0 mb-1 border-1 border-bottom"></div>
                <p class="creyTitle text-center mt-0 text-wrap">En digital informationstavle</p>
            </section>

            <section class="wrapper container">
                <div id="categories" class="row justify-content-center text-center">
                    @* No categories exist on any informationboards*@
                    @if (categoryList == null)
                    {
                    }
                    @*The order of the categories has not been altered*@
                    else if (informationboard.CategoryOrder == string.Empty )
                    {
                        foreach (var category in catList)
                        {
                            <a class="btn square col-5 m-1 p-1 d-flex align-items-center text-white shadow-lg rounded-3" href="@($"/{informationboard.InformationboardID}/{category.CategoryId}")">
                                <div class="mx-auto">
                                    <i class="@category.Icon"></i>
                                    @if (category.Title.Length > 11)
                                    {
                                        <p class="creyTitle fs-6 text-break">@category.Title</p>
                                    }
                                    else
                                    {
                                        <p class="creyTitle fs-4 text-break">@category.Title</p>
                                    }
                                </div>
                            </a>
                        }
                    }
                    @*The order of the categories has been altered*@
                    else
                    {
                        foreach (var id in categoryOrder)
                        {
                            <a class="btn square col-5 m-1 p-1 d-flex align-items-center text-white shadow-lg rounded-3" href="@($"/{informationboard.InformationboardID}/{CategoryDictionary[id].CategoryId}")">
                                <div class="mx-auto">
                                    <i class="@CategoryDictionary[id].Icon"></i>
                                    @if (CategoryDictionary[id].Title.Length > 11)
                                    {
                                        <p class="creyTitle fs-6 text-break">@CategoryDictionary[id].Title</p>
                                    }
                                    else
                                    {
                                        <p class="creyTitle fs-4 text-break">@CategoryDictionary[id].Title</p>
                                    }
                                </div>
                            </a>
                        }
                    }
                </div>
            </section>
        }

        @*Displays message if the selected information board is not publised OR if the selected information board has no categories*@
        if ((informationboardID == informationboard.InformationboardID && informationboard.IsPublished != true) || (informationboardID == informationboard.InformationboardID && catList.Count == 0))
        {
            <h1 class="col-10 text-center display-1 ms-0" style="color: white;">Der er ikke noget på denne side.</h1>
        }
    }
}

@code
{
    Informationboard[] informationboardList;
    Category[] categoryList;
    Dictionary<int, Category> CategoryDictionary = new Dictionary<int, Category>();
    List<int> categoryOrder = new();
    List<Category> catList = new();
    Informationboard selectedInformationBoard = new Informationboard();

    protected async override Task OnInitializedAsync()
    {
        informationboardList = await Http.GetFromJsonAsync<Informationboard[]>("api/Informationboard/InformationboardList");
        categoryList = await Http.GetFromJsonAsync<Category[]>("api/Category/CategoryList");
        catList = categoryList.Where(x => x.InformationBoardId == informationboardID).Select(x => x).ToList();
        CategoryToDictionary();

        selectedInformationBoard = informationboardList.Where(x => x.InformationboardID == informationboardID).Select(x => x).First();
        categoryOrder = CategoryOrderGenerator(selectedInformationBoard);
    }

    [Parameter]
    public int informationboardID { get; set; }
    [Parameter]
    public int categoryID { get; set; }

    public void CategoryToDictionary()
    {


        foreach (var category in catList)
        {
            CategoryDictionary.Add(category.CategoryId, category);
        }
    }

    public List<int> CategoryOrderGenerator(Informationboard informationboard)
    {
        List<string> stringIDList = informationboard.CategoryOrder.Split(",").ToList();
        List<int> intIDList = new();

        foreach (string item in stringIDList)
        {

            try
            {
                intIDList.Add(Convert.ToInt32(item));
            }
            catch (FormatException)
            {
            }
        }

        return intIDList;
    }
}
